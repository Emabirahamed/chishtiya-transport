<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ö‡¶ø‡¶∂‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü - ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
            animation: fadeIn 0.5s;
        }
        
        .login-box h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .login-box p {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Main Dashboard */
        .dashboard {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 24px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .role-admin { background: #4CAF50; color: white; }
        .role-manager { background: #2196F3; color: white; }
        .role-scanner { background: #FF9800; color: white; }
        
        .logout-btn {
            padding: 10px 20px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Noto Sans Bengali', sans-serif;
            font-weight: 600;
        }
        
        /* Tabs */
        .tabs {
            background: white;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-family: 'Noto Sans Bengali', sans-serif;
            font-weight: 600;
            font-size: 15px;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Cards */
        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Noto Sans Bengali', sans-serif;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Noto Sans Bengali', sans-serif;
            resize: vertical;
            min-height: 100px;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #333;
        }
        
        tr:hover {
            background: #f9f9f9;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-pending { background: #FFF3E0; color: #F57C00; }
        .status-loaded { background: #E3F2FD; color: #1976D2; }
        .status-unloaded { background: #F3E5F5; color: #7B1FA2; }
        .status-delivered { background: #E8F5E9; color: #388E3C; }
        
        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Noto Sans Bengali', sans-serif;
            font-size: 13px;
            font-weight: 600;
        }
        
        .btn-view { background: #2196F3; color: white; }
        .btn-qr { background: #9C27B0; color: white; }
        .btn-delete { background: #f44336; color: white; }
        .btn-pdf { background: #4CAF50; color: white; }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f44336;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
        }
        
        /* Timeline */
        .timeline {
            margin-top: 20px;
        }
        
        .timeline-item {
            padding: 15px;
            border-left: 3px solid #667eea;
            margin-left: 10px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 20px;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: #667eea;
        }
        
        .timeline-icon {
            font-size: 20px;
            margin-right: 8px;
        }
        
        /* Scanner */
        #scanner-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
        }
        
        #qr-reader {
            border: 2px solid #667eea;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .scan-result {
            margin-top: 20px;
            padding: 20px;
            background: #E8F5E9;
            border-radius: 12px;
            border-left: 4px solid #4CAF50;
        }
        
        /* Vehicle Cards */
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .vehicle-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .vehicle-card:hover {
            transform: translateY(-5px);
        }
        
        .vehicle-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .vehicle-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Alert Messages */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert.show {
            display: block;
            animation: slideDown 0.3s;
        }
        
        .alert-success { background: #E8F5E9; color: #2E7D32; border-left: 4px solid #4CAF50; }
        .alert-error { background: #FFEBEE; color: #C62828; border-left: 4px solid #f44336; }
        .alert-info { background: #E3F2FD; color: #1565C0; border-left: 4px solid #2196F3; }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                padding: 0 10px;
            }
            
            .tab-btn {
                padding: 12px 15px;
                font-size: 14px;
            }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1>üöõ ‡¶ö‡¶ø‡¶∂‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</h1>
            <p>‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</p>
            <div id="loginAlert" class="alert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                    <input type="email" id="loginEmail" required placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                </div>
                <div class="form-group">
                    <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="loginPassword" required placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                </div>
                <button type="submit" class="btn" id="loginBtn">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="dashboard">
        <!-- Header -->
        <div class="header">
            <h1>üöõ ‡¶ö‡¶ø‡¶∂‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h1>
            <div class="user-info">
                <span id="userName" style="font-weight: 600;"></span>
                <span id="userRole" class="user-badge"></span>
                <button class="logout-btn" onclick="logout()">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('addParcel')">‚ûï ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="tab-btn" onclick="switchTab('manageParcel')">üì¶ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
            <button class="tab-btn" onclick="switchTab('scanParcel')">üì∑ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</button>
            <button class="tab-btn" onclick="switchTab('vehicles')">üöõ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
            <button class="tab-btn" onclick="switchTab('reports')">üìÑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
            <button class="tab-btn" id="usersTab" onclick="switchTab('users')" style="display:none;">üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
        </div>

        <!-- Tab Contents -->
        <div class="tab-content active" id="addParcel">
            <div class="card">
                <h2>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <div id="addParcelAlert" class="alert"></div>
                <form id="addParcelForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                            <input type="text" id="senderName" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï‡ßá‡¶∞ ‡¶´‡ßã‡¶® *</label>
                            <input type="tel" id="senderPhone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                            <input type="text" id="receiverName" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï‡ßá‡¶∞ ‡¶´‡ßã‡¶® *</label>
                            <input type="tel" id="receiverPhone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø *</label>
                            <input type="text" id="destination" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶ì‡¶ú‡¶® (‡¶ï‡ßá‡¶ú‡¶ø)</label>
                            <input type="number" id="weight" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡¶ü‡¶æ‡¶ï‡¶æ) *</label>
                            <input type="number" id="charge" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ *</label>
                            <select id="paymentStatus" required>
                                <option value="‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</option>
                                <option value="‡¶¨‡¶æ‡¶ï‡¶ø">‡¶¨‡¶æ‡¶ï‡¶ø</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</label>
                        <textarea id="description"></textarea>
                    </div>
                    <button type="submit" class="btn">‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </form>
            </div>
        </div>

        <div class="tab-content" id="manageParcel">
            <div class="card">
                <h2>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                <div class="form-group">
                    <input type="text" id="searchParcel" placeholder="‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø, ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="searchParcels()">
                </div>
                <div class="table-container">
                    <table id="parcelTable">
                        <thead>
                            <tr>
                                <th>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                                <th>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï</th>
                                <th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï</th>
                                <th>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
                                <th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th>
                                <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="parcelTableBody">
                            <tr><td colspan="8" style="text-align:center;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="scanParcel">
            <div class="card">
                <h2>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <div id="scanner-container">
                    <div id="qr-reader"></div>
                </div>
                <div id="scanResult" style="display:none;" class="scan-result">
                    <h3>‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶∏‡¶´‡¶≤! üéâ</h3>
                    <p><strong>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø:</strong> <span id="scannedParcelId"></span></p>
                    <p><strong>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> <span id="scannedStatus"></span></p>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                        <select id="updateStatus">
                            <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            <option value="loaded">‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶§‡ßã‡¶≤‡¶æ (Loaded)</option>
                            <option value="unloaded">‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã (Unloaded)</option>
                            <option value="delivered">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°</option>
                        </select>
                    </div>
                    
                    <div id="vehicleInput" class="form-group" style="display:none;">
                        <label>‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                        <input type="text" id="vehicleNumber" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¢‡¶æ‡¶ï‡¶æ-‡¶Æ‡ßá‡¶ü‡ßç‡¶∞‡ßã-‡¶ó-‡ßß‡ß®-‡ß©‡ß™‡ß´‡ß¨">
                    </div>
                    
                    <div class="form-group">
                        <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®</label>
                        <input type="text" id="currentLocation" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¢‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶´‡¶ø‡¶∏">
                    </div>
                    
                    <button class="btn" onclick="updateParcelStatus()">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="vehicles">
            <div class="card">
                <h2>‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                <div id="vehicleGrid" class="vehicle-grid">
                    <div style="text-align:center; grid-column: 1/-1;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="reports">
            <div class="card">
                <h2>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                        <input type="date" id="reportEndDate">
                    </div>
                </div>
                <button class="btn" onclick="generateReport()">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                
                <div id="reportResult" style="display:none; margin-top: 30px;">
                    <h3>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø</h3>
                    <div class="vehicle-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalParcels">0</div>
                            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="deliveredParcels">0</div>
                            <div class="stat-label">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalRevenue">‡ß¶</div>
                            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º (‡¶ü‡¶æ‡¶ï‡¶æ)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="paidAmount">‡ß¶</div>
                            <div class="stat-label">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§ (‡¶ü‡¶æ‡¶ï‡¶æ)</div>
                        </div>
                    </div>
                    <button class="btn btn-pdf" onclick="downloadReportPDF()" style="margin-top: 20px;">PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                                    <th>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï</th>
                                    <th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï</th>
                                    <th>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
                                    <th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th>
                                    <th>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</th>
                                    <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="users">
            <div class="card">
                <h2>‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <div id="userAlert" class="alert"></div>
                <form id="addUserForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Firebase UID *</label>
                            <input type="text" id="userUid" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶®‡¶æ‡¶Æ *</label>
                            <input type="text" id="userDisplayName" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤ *</label>
                            <input type="email" id="userEmail" required>
                        </div>
                        <div class="form-group">
                            <label>‡¶∞‡ßã‡¶≤ *</label>
                            <select id="userRole" required>
                                <option value="admin">Admin</option>
                                <option value="manager">Manager</option>
                                <option value="scanner">Scanner</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </form>
            </div>
            
            <div class="card">
                <h2>‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‡¶®‡¶æ‡¶Æ</th>
                                <th>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</th>
                                <th>‡¶∞‡ßã‡¶≤</th>
                                <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr><td colspan="4" style="text-align:center;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- View Parcel Modal -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('viewModal')">√ó</button>
            <h2>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏</h2>
            <div id="parcelDetails"></div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <button class="modal-close" onclick="closeModal('qrModal')">√ó</button>
            <h2>QR ‡¶ï‡ßã‡¶°</h2>
            <div id="qrCodeContainer"></div>
            <button class="btn" onclick="downloadQR()" style="margin-top: 20px;">QR ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Vehicle Details Modal -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('vehicleModal')">√ó</button>
            <h2 id="vehicleModalTitle"></h2>
            <div id="vehicleDetails"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        // Firebase Configuration
       // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyC2BMeBAU-7tLrBw0dKehAVix6mT9C4lWI",
  authDomain: "chishtiya-transport.firebaseapp.com",
  projectId: "chishtiya-transport",
  storageBucket: "chishtiya-transport.firebasestorage.app",
  messagingSenderId: "796543197916",
  appId: "1:796543197916:web:64a0e89d68280986a60a19"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global Variables
        let currentUser = null;
        let userRole = null;
        let html5QrCode = null;
        let scannedParcelData = null;
        let allParcels = [];
        let reportData = [];

        // Check Auth State
        auth.onAuthStateChanged(user => {
            if (user) {
                // Get user role
                database.ref('users/' + user.uid).once('value').then(snapshot => {
                    const userData = snapshot.val();
                    if (userData) {
                        currentUser = user;
                        userRole = userData.role;
                        document.getElementById('userName').textContent = userData.displayName;
                        document.getElementById('userRole').textContent = userData.role.toUpperCase();
                        document.getElementById('userRole').className = 'user-badge role-' + userData.role;
                        
                        // Show/hide tabs based on role
                        if (userRole === 'admin') {
                            document.getElementById('usersTab').style.display = 'block';
                        }
                        
                        if (userRole === 'scanner') {
                            // Hide some tabs for scanner
                            document.querySelector('[onclick="switchTab(\'addParcel\')"]').style.display = 'none';
                            document.querySelector('[onclick="switchTab(\'reports\')"]').style.display = 'none';
                        }
                        
                        document.getElementById('loginPage').style.display = 'none';
                        document.getElementById('dashboardPage').style.display = 'block';
                        
                        loadParcels();
                        loadUsers();
                    } else {
                        logout();
                    }
                });
            } else {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboardPage').style.display = 'none';
            }
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            
            btn.disabled = true;
            btn.textContent = '‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showAlert('loginAlert', '‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            } catch (error) {
                showAlert('loginAlert', '‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ' + error.message, 'error');
                btn.disabled = false;
                btn.textContent = '‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®';
            }
        });

        // Logout
        function logout() {
            auth.signOut();
        }

        // Switch Tab
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'scanParcel' && !html5QrCode) {
                initScanner();
            }
            
            if (tabName === 'vehicles') {
                loadVehicles();
            }
        }

        // Add Parcel
        document.getElementById('addParcelForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const parcelData = {
                senderName: document.getElementById('senderName').value,
                senderPhone: document.getElementById('senderPhone').value,
                receiverName: document.getElementById('receiverName').value,
                receiverPhone: document.getElementById('receiverPhone').value,
                destination: document.getElementById('destination').value,
                weight: document.getElementById('weight').value || '',
                charge: parseFloat(document.getElementById('charge').value),
                paymentStatus: document.getElementById('paymentStatus').value,
                description: document.getElementById('description').value || '',
                status: 'pending',
                createdAt: new Date().toISOString(),
                createdBy: currentUser.displayName || currentUser.email,
                currentLocation: '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶´‡¶ø‡¶∏',
                vehicleNumber: ''
            };
            
            try {
                // Get counter
                const counterRef = database.ref('counter');
                const snapshot = await counterRef.once('value');
                let counter = snapshot.val() || 0;
                counter++;
                
                const parcelId = 'CT' + counter.toString().padStart(6, '0');
                parcelData.id = parcelId;
                
                // Add tracking history
                parcelData.tracking = [{
                    status: 'pending',
                    description: '‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                    location: '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶´‡¶ø‡¶∏',
                    timestamp: new Date().toISOString(),
                    user: currentUser.displayName || currentUser.email
                }];
                
                // Save parcel
                await database.ref('parcels/' + parcelId).set(parcelData);
                await counterRef.set(counter);
                
                showAlert('addParcelAlert', '‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø: ' + parcelId, 'success');
                document.getElementById('addParcelForm').reset();
                loadParcels();
            } catch (error) {
                showAlert('addParcelAlert', '‡¶è‡¶∞‡¶∞: ' + error.message, 'error');
            }
        });

        // Load Parcels
        function loadParcels() {
            database.ref('parcels').on('value', snapshot => {
                allParcels = [];
                const tbody = document.getElementById('parcelTableBody');
                tbody.innerHTML = '';
                
                snapshot.forEach(childSnapshot => {
                    const parcel = childSnapshot.val();
                    allParcels.push(parcel);
                    
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td><strong>${parcel.id}</strong></td>
                        <td>${parcel.senderName}<br><small>${parcel.senderPhone}</small></td>
                        <td>${parcel.receiverName}<br><small>${parcel.receiverPhone}</small></td>
                        <td>${parcel.destination}</td>
                        <td>‡ß≥${parcel.charge}</td>
                        <td><span class="status-badge status-${parcel.status}">${getStatusText(parcel.status)}</span></td>
                        <td>${formatDate(parcel.createdAt)}</td>
                        <td>
                            <div class="action-btns">
                                <button class="btn-sm btn-view" onclick="viewParcel('${parcel.id}')">üëÅÔ∏è ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                                <button class="btn-sm btn-qr" onclick="showQR('${parcel.id}')">QR</button>
                                ${(userRole === 'admin' || userRole === 'manager') ? `<button class="btn-sm btn-delete" onclick="deleteParcel('${parcel.id}')">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>` : ''}
                            </div>
                        </td>
                    `;
                });
                
                if (allParcels.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">‡¶ï‡ßã‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶®‡ßá‡¶á</td></tr>';
                }
            });
        }

        // Search Parcels
        function searchParcels() {
            const searchTerm = document.getElementById('searchParcel').value.toLowerCase();
            const tbody = document.getElementById('parcelTableBody');
            tbody.innerHTML = '';
            
            const filtered = allParcels.filter(parcel => 
                parcel.id.toLowerCase().includes(searchTerm) ||
                parcel.senderName.toLowerCase().includes(searchTerm) ||
                parcel.senderPhone.includes(searchTerm) ||
                parcel.receiverName.toLowerCase().includes(searchTerm) ||
                parcel.receiverPhone.includes(searchTerm)
            );
            
            filtered.forEach(parcel => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${parcel.id}</strong></td>
                    <td>${parcel.senderName}<br><small>${parcel.senderPhone}</small></td>
                    <td>${parcel.receiverName}<br><small>${parcel.receiverPhone}</small></td>
                    <td>${parcel.destination}</td>
                    <td>‡ß≥${parcel.charge}</td>
                    <td><span class="status-badge status-${parcel.status}">${getStatusText(parcel.status)}</span></td>
                    <td>${formatDate(parcel.createdAt)}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-sm btn-view" onclick="viewParcel('${parcel.id}')">üëÅÔ∏è ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                            <button class="btn-sm btn-qr" onclick="showQR('${parcel.id}')">QR</button>
                            ${(userRole === 'admin' || userRole === 'manager') ? `<button class="btn-sm btn-delete" onclick="deleteParcel('${parcel.id}')">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>` : ''}
                        </div>
                    </td>
                `;
            });
            
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">‡¶ï‡ßã‡¶® ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</td></tr>';
            }
        }

        // View Parcel Details
        async function viewParcel(parcelId) {
            const snapshot = await database.ref('parcels/' + parcelId).once('value');
            const parcel = snapshot.val();
            
            if (!parcel) return;
            
            let trackingHtml = '<div class="timeline">';
            if (parcel.tracking) {
                parcel.tracking.forEach(track => {
                    const icon = getTrackingIcon(track.status);
                    trackingHtml += `
                        <div class="timeline-item">
                            <span class="timeline-icon">${icon}</span>
                            <strong>${track.description}</strong><br>
                            üìç ${track.location || 'N/A'}<br>
                            ${track.vehicleNumber ? `üöõ ${track.vehicleNumber}<br>` : ''}
                            ‚è∞ ${formatDateTime(track.timestamp)}<br>
                            üë§ ${track.user}
                        </div>
                    `;
                });
            }
            trackingHtml += '</div>';
            
            document.getElementById('parcelDetails').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div><strong>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø:</strong> ${parcel.id}</div>
                    <div><strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> <span class="status-badge status-${parcel.status}">${getStatusText(parcel.status)}</span></div>
                    <div><strong>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï:</strong> ${parcel.senderName}</div>
                    <div><strong>‡¶´‡ßã‡¶®:</strong> ${parcel.senderPhone}</div>
                    <div><strong>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï:</strong> ${parcel.receiverName}</div>
                    <div><strong>‡¶´‡ßã‡¶®:</strong> ${parcel.receiverPhone}</div>
                    <div><strong>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${parcel.destination}</div>
                    <div><strong>‡¶ì‡¶ú‡¶®:</strong> ${parcel.weight || 'N/A'} ‡¶ï‡ßá‡¶ú‡¶ø</div>
                    <div><strong>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:</strong> ‡ß≥${parcel.charge}</div>
                    <div><strong>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</strong> ${parcel.paymentStatus}</div>
                    <div><strong>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®:</strong> ${parcel.currentLocation || 'N/A'}</div>
                    <div><strong>‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</strong> ${parcel.vehicleNumber || 'N/A'}</div>
                </div>
                ${parcel.description ? `<p><strong>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</strong> ${parcel.description}</p>` : ''}
                <h3 style="margin-top: 20px;">‡¶Æ‡ßÅ‡¶≠‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
                ${trackingHtml}
            `;
            
            document.getElementById('viewModal').classList.add('active');
        }

        // Show QR Code
        function showQR(parcelId) {
            document.getElementById('qrCodeContainer').innerHTML = '';
            const qrcode = new QRCode(document.getElementById('qrCodeContainer'), {
                text: parcelId,
                width: 256,
                height: 256
            });
            document.getElementById('qrModal').classList.add('active');
        }

        // Download QR
        function downloadQR() {
            const canvas = document.querySelector('#qrCodeContainer canvas');
            const url = canvas.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = url;
            a.download = 'qr-code.png';
            a.click();
        }

        // Initialize Scanner
        function initScanner() {
            html5QrCode = new Html5Qrcode("qr-reader");
            
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                async (decodedText) => {
                    html5QrCode.stop();
                    
                    // Load parcel data
                    const snapshot = await database.ref('parcels/' + decodedText).once('value');
                    const parcel = snapshot.val();
                    
                    if (parcel) {
                        scannedParcelData = parcel;
                        document.getElementById('scannedParcelId').textContent = parcel.id;
                        document.getElementById('scannedStatus').textContent = getStatusText(parcel.status);
                        document.getElementById('currentLocation').value = parcel.currentLocation || '';
                        document.getElementById('scanResult').style.display = 'block';
                    } else {
                        alert('‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                    }
                }
            ).catch(err => {
                console.error('Scanner error:', err);
            });
        }

        // Update status dropdown handler
        document.getElementById('updateStatus').addEventListener('change', (e) => {
            if (e.target.value === 'loaded') {
                document.getElementById('vehicleInput').style.display = 'block';
            } else {
                document.getElementById('vehicleInput').style.display = 'none';
            }
        });

        // Update Parcel Status
        async function updateParcelStatus() {
            const newStatus = document.getElementById('updateStatus').value;
            const location = document.getElementById('currentLocation').value;
            const vehicleNumber = document.getElementById('vehicleNumber').value;
            
            if (!newStatus) {
                alert('‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }
            
            if (newStatus === 'loaded' && !vehicleNumber) {
                alert('‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                return;
            }
            
            if (!location) {
                alert('‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                return;
            }
            
            try {
                const parcelRef = database.ref('parcels/' + scannedParcelData.id);
                
                // Get current tracking
                const snapshot = await parcelRef.once('value');
                const currentData = snapshot.val();
                const tracking = currentData.tracking || [];
                
                // Add new tracking entry
                tracking.push({
                    status: newStatus,
                    description: getStatusDescription(newStatus),
                    location: location,
                    vehicleNumber: vehicleNumber || '',
                    timestamp: new Date().toISOString(),
                    user: currentUser.displayName || currentUser.email
                });
                
                // Update parcel
                await parcelRef.update({
                    status: newStatus,
                    currentLocation: location,
                    vehicleNumber: vehicleNumber || currentData.vehicleNumber || '',
                    tracking: tracking
                });
                
                alert('‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                
                // Reset form
                document.getElementById('scanResult').style.display = 'none';
                document.getElementById('updateStatus').value = '';
                document.getElementById('vehicleNumber').value = '';
                document.getElementById('currentLocation').value = '';
                
                // Restart scanner
                initScanner();
                
            } catch (error) {
                alert('‡¶è‡¶∞‡¶∞: ' + error.message);
            }
        }

        // Load Vehicles
        function loadVehicles() {
            database.ref('parcels').once('value', snapshot => {
                const vehicles = {};
                
                snapshot.forEach(childSnapshot => {
                    const parcel = childSnapshot.val();
                    if (parcel.vehicleNumber && parcel.status !== 'delivered') {
                        if (!vehicles[parcel.vehicleNumber]) {
                            vehicles[parcel.vehicleNumber] = {
                                number: parcel.vehicleNumber,
                                parcels: [],
                                destinations: new Set()
                            };
                        }
                        vehicles[parcel.vehicleNumber].parcels.push(parcel);
                        vehicles[parcel.vehicleNumber].destinations.add(parcel.destination);
                    }
                });
                
                const grid = document.getElementById('vehicleGrid');
                grid.innerHTML = '';
                
                Object.values(vehicles).forEach(vehicle => {
                    const loaded = vehicle.parcels.filter(p => p.status === 'loaded').length;
                    const unloaded = vehicle.parcels.filter(p => p.status === 'unloaded').length;
                    
                    const card = document.createElement('div');
                    card.className = 'vehicle-card';
                    card.onclick = () => showVehicleDetails(vehicle);
                    card.innerHTML = `
                        <h3>üöõ ${vehicle.number}</h3>
                        <p><strong>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${Array.from(vehicle.destinations).join(', ')}</p>
                        <div class="vehicle-stats">
                            <div class="stat-item">
                                <div class="stat-value">${vehicle.parcels.length}</div>
                                <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${loaded}</div>
                                <div class="stat-label">‡¶≤‡ßã‡¶°‡ßá‡¶°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${unloaded}</div>
                                <div class="stat-label">‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°</div>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });
                
                if (Object.keys(vehicles).length === 0) {
                    grid.innerHTML = '<div style="text-align:center; grid-column: 1/-1;">‡¶ï‡ßã‡¶® ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>';
                }
            });
        }

        // Show Vehicle Details
        function showVehicleDetails(vehicle) {
            document.getElementById('vehicleModalTitle').textContent = 'üöõ ' + vehicle.number;
            
            let html = '<h3>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>';
            html += '<div class="table-container"><table>';
            html += '<thead><tr><th>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</th><th>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï</th><th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï</th><th>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th></tr></thead><tbody>';
            
            vehicle.parcels.forEach(parcel => {
                html += `
                    <tr>
                        <td>${parcel.id}</td>
                        <td>${parcel.senderName}</td>
                        <td>${parcel.receiverName}</td>
                        <td>${parcel.destination}</td>
                        <td><span class="status-badge status-${parcel.status}">${getStatusText(parcel.status)}</span></td>
                        <td>‡ß≥${parcel.charge}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            
            // Movement History
            html += '<h3 style="margin-top: 30px;">‡¶Æ‡ßÅ‡¶≠‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3><div class="timeline">';
            
            vehicle.parcels.forEach(parcel => {
                if (parcel.tracking) {
                    parcel.tracking.forEach(track => {
                        if (track.vehicleNumber === vehicle.number) {
                            const icon = getTrackingIcon(track.status);
                            html += `
                                <div class="timeline-item">
                                    <span class="timeline-icon">${icon}</span>
                                    <strong>${parcel.id} - ${track.description}</strong><br>
                                    üìç ${track.location}<br>
                                    ‚è∞ ${formatDateTime(track.timestamp)}<br>
                                    üë§ ${track.user}
                                </div>
                            `;
                        }
                    });
                }
            });
            
            html += '</div>';
            html += '<button class="btn btn-pdf" onclick="downloadVehiclePDF(\'' + vehicle.number + '\')" style="margin-top: 20px;">PDF ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>';
            
            document.getElementById('vehicleDetails').innerHTML = html;
            document.getElementById('vehicleModal').classList.add('active');
        }

        // Generate Report
        async function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                alert('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }
            
            const snapshot = await database.ref('parcels').once('value');
            reportData = [];
            let totalRevenue = 0;
            let paidAmount = 0;
            let deliveredCount = 0;
            
            snapshot.forEach(childSnapshot => {
                const parcel = childSnapshot.val();
                const parcelDate = parcel.createdAt.split('T')[0];
                
                if (parcelDate >= startDate && parcelDate <= endDate) {
                    reportData.push(parcel);
                    totalRevenue += parcel.charge;
                    if (parcel.paymentStatus === '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§') {
                        paidAmount += parcel.charge;
                    }
                    if (parcel.status === 'delivered') {
                        deliveredCount++;
                    }
                }
            });
            
            document.getElementById('totalParcels').textContent = reportData.length;
            document.getElementById('deliveredParcels').textContent = deliveredCount;
            document.getElementById('totalRevenue').textContent = '‡ß≥' + totalRevenue.toLocaleString('bn-BD');
            document.getElementById('paidAmount').textContent = '‡ß≥' + paidAmount.toLocaleString('bn-BD');
            
            const tbody = document.getElementById('reportTableBody');
            tbody.innerHTML = '';
            
            reportData.forEach(parcel => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${parcel.id}</td>
                    <td>${parcel.senderName}<br><small>${parcel.senderPhone}</small></td>
                    <td>${parcel.receiverName}<br><small>${parcel.receiverPhone}</small></td>
                    <td>${parcel.destination}</td>
                    <td>‡ß≥${parcel.charge}</td>
                    <td>${parcel.paymentStatus}</td>
                    <td><span class="status-badge status-${parcel.status}">${getStatusText(parcel.status)}</span></td>
                    <td>${formatDate(parcel.createdAt)}</td>
                `;
            });
            
            document.getElementById('reportResult').style.display = 'block';
        }

        // Download Report PDF
        function downloadReportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add Noto Sans Bengali font (you'll need to add this separately)
            doc.setFont('helvetica');
            doc.setFontSize(16);
            doc.text('Chishtia Transport Report', 14, 15);
            
            const tableData = reportData.map(p => [
                p.id,
                p.senderName,
                p.receiverName,
                p.destination,
                p.charge,
                p.paymentStatus,
                getStatusText(p.status),
                formatDate(p.createdAt)
            ]);
            
            doc.autoTable({
                head: [['ID', 'Sender', 'Receiver', 'Destination', 'Charge', 'Payment', 'Status', 'Date']],
                body: tableData,
                startY: 25
            });
            
            doc.save('report.pdf');
        }

        // Download Vehicle PDF
        async function downloadVehiclePDF(vehicleNumber) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const snapshot = await database.ref('parcels').once('value');
            const parcels = [];
            
            snapshot.forEach(childSnapshot => {
                const parcel = childSnapshot.val();
                if (parcel.vehicleNumber === vehicleNumber) {
                    parcels.push(parcel);
                }
            });
            
            doc.setFont('helvetica');
            doc.setFontSize(16);
            doc.text('Vehicle Report: ' + vehicleNumber, 14, 15);
            
            const tableData = parcels.map(p => [
                p.id,
                p.senderName,
                p.receiverName,
                p.destination,
                p.charge,
                getStatusText(p.status)
            ]);
            
            doc.autoTable({
                head: [['ID', 'Sender', 'Receiver', 'Destination', 'Charge', 'Status']],
                body: tableData,
                startY: 25
            });
            
            doc.save('vehicle-' + vehicleNumber + '.pdf');
        }

        // Delete Parcel
        async function deleteParcel(parcelId) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                try {
                    await database.ref('parcels/' + parcelId).remove();
                    alert('‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
                    loadParcels();
                } catch (error) {
                    alert('‡¶è‡¶∞‡¶∞: ' + error.message);
                }
            }
        }

        // Add User
        document.getElementById('addUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userData = {
                uid: document.getElementById('userUid').value,
                displayName: document.getElementById('userDisplayName').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value
            };
            
            try {
                await database.ref('users/' + userData.uid).set(userData);
                showAlert('userAlert', '‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                document.getElementById('addUserForm').reset();
                loadUsers();
            } catch (error) {
                showAlert('userAlert', '‡¶è‡¶∞‡¶∞: ' + error.message, 'error');
            }
        });

        // Load Users
        function loadUsers() {
            if (userRole !== 'admin') return;
            
            database.ref('users').on('value', snapshot => {
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = '';
                
                snapshot.forEach(childSnapshot => {
                    const user = childSnapshot.val();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${user.displayName}</td>
                        <td>${user.email}</td>
                        <td><span class="user-badge role-${user.role}">${user.role.toUpperCase()}</span></td>
                        <td>
                            ${user.uid !== currentUser.uid ? `<button class="btn-sm btn-delete" onclick="deleteUser('${user.uid}')">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>` : ''}
                        </td>
                    `;
                });
            });
        }

        // Delete User
        async function deleteUser(uid) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                try {
                    await database.ref('users/' + uid).remove();
                    alert('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
                } catch (error) {
                    alert('‡¶è‡¶∞‡¶∞: ' + error.message);
                }
            }
        }

        // Helper Functions
        function getStatusText(status) {
            const statuses = {
                'pending': '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç',
                'loaded': '‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶§‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'unloaded': '‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'
            };
            return statuses[status] || status;
        }

        function getStatusDescription(status) {
            const descriptions = {
                'loaded': '‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶§‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'unloaded': '‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'
            };
            return descriptions[status] || status;
        }

        function getTrackingIcon(status) {
            const icons = {
                'pending': 'üìù',
                'loaded': 'üöõ',
                'unloaded': 'üì¶',
                'delivered': '‚úÖ'
            };
            return icons[status] || 'üìç';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('bn-BD');
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('bn-BD');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAlert(elementId, message, type) {
            const alert = document.getElementById(elementId);
            alert.className = 'alert alert-' + type + ' show';
            alert.textContent = message;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Close modal on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
