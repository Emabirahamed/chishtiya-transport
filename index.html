<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ö‡¶ø‡¶∂‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .user-info {
            position: absolute;
            top: 30px;
            right: 30px;
            text-align: right;
        }

        .header .user-info button {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .header .user-info button:hover {
            background: white;
            color: #667eea;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-container h2 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            padding: 0;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            max-width: 500px;
            margin: 0 auto;
        }

        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            font-weight: 600;
        }

        tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        .badge-loaded {
            background: #cce5ff;
            color: #004085;
        }

        .badge-unloaded {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-delivered {
            background: #d4edda;
            color: #155724;
        }

        .badge-admin {
            background: #dc3545;
            color: white;
        }

        .badge-manager {
            background: #007bff;
            color: white;
        }

        .badge-scanner {
            background: #28a745;
            color: white;
        }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Hind Siliguri', sans-serif;
        }

        .btn-view {
            background: #17a2b8;
            color: white;
        }

        .btn-qr {
            background: #6c757d;
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-small:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 20px;
            position: relative;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: #333;
        }

        .qr-container {
            text-align: center;
            padding: 20px;
        }

        #qr-reader {
            max-width: 500px;
            margin: 0 auto;
            border: 3px solid #667eea;
            border-radius: 15px;
            overflow: hidden;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Hind Siliguri', sans-serif;
        }

        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .vehicle-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .vehicle-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .vehicle-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .vehicle-stat {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .vehicle-stat .label {
            font-size: 12px;
            color: #666;
        }

        .vehicle-stat .value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
            border-left: 2px solid #e0e0e0;
            padding-left: 30px;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
        }

        .timeline-item .time {
            font-size: 12px;
            color: #999;
        }

        .timeline-item .description {
            font-weight: 600;
            color: #333;
            margin: 5px 0;
        }

        .timeline-item .location {
            font-size: 14px;
            color: #666;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5em;
            }

            .header .user-info {
                position: static;
                margin-top: 20px;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                border-bottom: 1px solid #e0e0e0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .action-btns {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h2>üöõ ‡¶ö‡¶ø‡¶∂‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
        <div class="form-group">
            <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
            <input type="email" id="loginEmail" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
        </div>
        <div class="form-group">
            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
            <input type="password" id="loginPassword" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
        </div>
        <button class="btn" onclick="login()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div id="loginError" style="color: red; margin-top: 10px; text-align: center;"></div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container" style="display: none;">
        <div class="header">
            <h1>üöõ ‡¶ö‡¶ø‡¶∂‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ</h1>
            <div class="user-info">
                <div id="userDisplay"></div>
                <button onclick="logout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab(0)">üìä ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
            <button class="tab" onclick="showTab(1)">‚ûï ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="tab" onclick="showTab(2)">üì¶ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
            <button class="tab" onclick="showTab(3)">üì∑ ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</button>
            <button class="tab" onclick="showTab(4)">üöõ ‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</button>
            <button class="tab" onclick="showTab(5)">üìÑ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
            <button class="tab" id="userManagementTab" onclick="showTab(6)" style="display: none;">üë• ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</button>
        </div>

        <!-- Tab 0: Dashboard -->
        <div class="tab-content active" id="tab0">
            <h2>‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</h3>
                    <div class="value" id="totalParcels">0</div>
                </div>
                <div class="stat-card">
                    <h3>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</h3>
                    <div class="value" id="deliveredParcels">0</div>
                </div>
                <div class="stat-card">
                    <h3>‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</h3>
                    <div class="value" id="pendingParcels">0</div>
                </div>
                <div class="stat-card">
                    <h3>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</h3>
                    <div class="value" id="totalRevenue">‡ß¶ ‡ß≥</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        <!-- Tab 1: Add Parcel -->
        <div class="tab-content" id="tab1">
            <h2>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <form onsubmit="addParcel(event)">
                <div class="form-group">
                    <label>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="senderName" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï‡ßá‡¶∞ ‡¶´‡ßã‡¶® *</label>
                    <input type="tel" id="senderPhone" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ *</label>
                    <input type="text" id="receiverName" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï‡ßá‡¶∞ ‡¶´‡ßã‡¶® *</label>
                    <input type="tel" id="receiverPhone" required>
                </div>
                <div class="form-group">
                    <label>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø *</label>
                    <select id="destination" required>
                        <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                        <option value="‡¶´‡ßá‡¶®‡ßÄ">‡¶´‡ßá‡¶®‡ßÄ</option>
                        <option value="‡¶õ‡¶æ‡¶ó‡¶≤‡¶®‡¶æ‡¶á‡¶Ø‡¶º‡¶æ">‡¶õ‡¶æ‡¶ó‡¶≤‡¶®‡¶æ‡¶á‡¶Ø‡¶º‡¶æ</option>
                        <option value="‡¶¨‡¶∏‡ßÅ‡¶∞‡¶π‡¶æ‡¶ü">‡¶¨‡¶∏‡ßÅ‡¶∞‡¶π‡¶æ‡¶ü</option>
                        <option value="‡¶¶‡¶æ‡¶ó‡¶®‡¶≠‡ßÇ‡¶û‡¶æ">‡¶¶‡¶æ‡¶ó‡¶®‡¶≠‡ßÇ‡¶û‡¶æ</option>
                        <option value="‡¶Æ‡ßÅ‡¶∞‡¶æ‡¶¶‡¶™‡ßÅ‡¶∞">‡¶Æ‡ßÅ‡¶∞‡¶æ‡¶¶‡¶™‡ßÅ‡¶∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡¶ì‡¶ú‡¶® (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <input type="text" id="weight" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß´ ‡¶ï‡ßá‡¶ú‡¶ø">
                </div>
                <div class="form-group">
                    <label>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú *</label>
                    <input type="number" id="deliveryCharge" required>
                </div>
                <div class="form-group">
                    <label>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ *</label>
                    <select id="paymentStatus" required>
                        <option value="‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</option>
                        <option value="‡¶¨‡¶æ‡¶ï‡¶ø">‡¶¨‡¶æ‡¶ï‡¶ø</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
                    <textarea id="description" rows="3"></textarea>
                </div>
                <button type="submit" class="btn">‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div id="addParcelMessage"></div>
        </div>

        <!-- Tab 2: Parcel Management -->
        <div class="tab-content" id="tab2">
            <h2>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
            <div class="search-box">
                <input type="text" id="searchParcel" placeholder="‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø, ‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="searchParcels()">
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                            <th>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï</th>
                            <th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï</th>
                            <th>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
                            <th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th>
                            <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                            <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                        </tr>
                    </thead>
                    <tbody id="parcelTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Tab 3: Scan Parcel -->
        <div class="tab-content" id="tab3">
            <h2>QR ‡¶ï‡ßã‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn" onclick="startScanner()" id="startScanBtn">‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="btn" onclick="stopScanner()" id="stopScanBtn" style="display: none; background: #dc3545;">‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
            <div id="qr-reader"></div>
            <div id="scanResult" style="margin-top: 20px;"></div>
        </div>

        <!-- Tab 4: Vehicle Management -->
        <div class="tab-content" id="tab4">
            <h2>‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
            <div class="vehicle-grid" id="vehicleGrid"></div>
        </div>

        <!-- Tab 5: Reports -->
        <div class="tab-content" id="tab5">
            <h2>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label>‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                    <input type="date" id="reportStartDate">
                </div>
                <div class="form-group">
                    <label>‡¶∂‡ßá‡¶∑ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</label>
                    <input type="date" id="reportEndDate">
                </div>
            </div>
            <button class="btn" onclick="generateReport()">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
            <div id="reportContent" style="margin-top: 30px;"></div>
        </div>

        <!-- Tab 6: User Management -->
        <div class="tab-content" id="tab6">
            <h2>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
            <div style="background: #f5f5f5; padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <form onsubmit="addUser(event)">
                    <div class="form-group">
                        <label>Firebase UID *</label>
                        <input type="text" id="newUserUid" required>
                    </div>
                    <div class="form-group">
                        <label>‡¶®‡¶æ‡¶Æ *</label>
                        <input type="text" id="newUserName" required>
                    </div>
                    <div class="form-group">
                        <label>‡¶á‡¶Æ‡ßá‡¶á‡¶≤ *</label>
                        <input type="email" id="newUserEmail" required>
                    </div>
                    <div class="form-group">
                        <label>‡¶∞‡ßã‡¶≤ *</label>
                        <select id="newUserRole" required>
                            <option value="admin">Admin</option>
                            <option value="manager">Manager</option>
                            <option value="scanner">Scanner</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </form>
            </div>
            <h3>‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>‡¶®‡¶æ‡¶Æ</th>
                            <th>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</th>
                            <th>‡¶∞‡ßã‡¶≤</th>
                            <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="parcelModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('parcelModal')">&times;</span>
            <div id="parcelDetails"></div>
        </div>
    </div>

    <div id="qrModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('qrModal')">&times;</span>
            <div class="qr-container">
                <h3 id="qrTitle"></h3>
                <div id="qrcode" style="margin: 20px auto; display: inline-block;"></div>
                <br>
                <button class="btn" onclick="downloadQR()">QR ‡¶ï‡ßã‡¶° ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('vehicleModal')">&times;</span>
            <div id="vehicleDetails"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getDatabase, ref, set, get, push, remove, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyC2BMeBAU-7tLrBw0dKehAVix6mT9C4lWI",
            databaseURL: "https://chishtiya-transport-default-rtdb.asia-southeast1.firebasedatabase.app",
            authDomain: "chishtiya-transport.firebaseapp.com",
            projectId: "chishtiya-transport",
            storageBucket: "chishtiya-transport.firebasestorage.app",
            messagingSenderId: "796543197916",
            appId: "1:796543197916:web:64a0e89d68280986a60a19"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        window.auth = auth;
        window.database = database;
        window.firebaseRefs = { ref, set, get, push, remove, onValue, update };
        window.firebaseAuth = { signInWithEmailAndPassword, signOut, onAuthStateChanged };

        let currentUser = null;
        let currentUserData = null;
        let allParcels = [];
        let html5QrCode = null;

        // Auth State Observer
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                const userRef = ref(database, 'users/' + user.uid);
                const snapshot = await get(userRef);
                
                if (snapshot.exists()) {
                    currentUserData = snapshot.val();
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    document.getElementById('userDisplay').innerHTML = `
                        <div>${currentUserData.name}</div>
                        <div style="font-size: 12px; opacity: 0.8;">${currentUserData.role}</div>
                    `;
                    
                    if (currentUserData.role === 'admin') {
                        document.getElementById('userManagementTab').style.display = 'block';
                    }
                    
                    loadDashboard();
                    loadParcels();
                    loadVehicles();
                    loadUsers();
                } else {
                    alert('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                    signOut(auth);
                }
            } else {
                currentUser = null;
                currentUserData = null;
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        window.login = async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                errorDiv.textContent = '‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§';
            }
        };

        window.logout = async () => {
            await signOut(auth);
        };

        window.showTab = (index) => {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            tabs[index].classList.add('active');
            contents[index].classList.add('active');
        };

        async function loadDashboard() {
            const parcelsRef = ref(database, 'parcels');
            onValue(parcelsRef, (snapshot) => {
                const parcels = [];
                snapshot.forEach((child) => {
                    parcels.push({ id: child.key, ...child.val() });
                });

                const total = parcels.length;
                const delivered = parcels.filter(p => p.status === 'delivered').length;
                const pending = parcels.filter(p => p.status === 'pending').length;
                const loaded = parcels.filter(p => p.status === 'loaded').length;
                const unloaded = parcels.filter(p => p.status === 'unloaded').length;
                const revenue = parcels.reduce((sum, p) => sum + (parseInt(p.deliveryCharge) || 0), 0);

                document.getElementById('totalParcels').textContent = total;
                document.getElementById('deliveredParcels').textContent = delivered;
                document.getElementById('pendingParcels').textContent = pending;
                document.getElementById('totalRevenue').textContent = revenue.toLocaleString('bn-BD') + ' ‡ß≥';

                // Chart
                const ctx = document.getElementById('statusChart');
                if (window.statusChartInstance) {
                    window.statusChartInstance.destroy();
                }
                window.statusChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç', '‡¶≤‡ßã‡¶°‡ßá‡¶°', '‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°', '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'],
                        datasets: [{
                            data: [pending, loaded, unloaded, delivered],
                            backgroundColor: ['#ffc107', '#17a2b8', '#6c757d', '#28a745']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            });
        }

        window.addParcel = async (e) => {
            e.preventDefault();
            
            const counterRef = ref(database, 'counter');
            const counterSnapshot = await get(counterRef);
            let counter = counterSnapshot.exists() ? counterSnapshot.val() : 0;
            counter++;
            
            const parcelId = 'CT' + String(counter).padStart(6, '0');
            
            const parcelData = {
                parcelId: parcelId,
                senderName: document.getElementById('senderName').value,
                senderPhone: document.getElementById('senderPhone').value,
                receiverName: document.getElementById('receiverName').value,
                receiverPhone: document.getElementById('receiverPhone').value,
                destination: document.getElementById('destination').value,
                weight: document.getElementById('weight').value || '',
                deliveryCharge: document.getElementById('deliveryCharge').value,
                paymentStatus: document.getElementById('paymentStatus').value,
                description: document.getElementById('description').value || '',
                status: 'pending',
                createdAt: new Date().toISOString(),
                createdBy: currentUserData.name,
                tracking: [{
                    status: '‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                    location: '‡¶¢‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶´‡¶ø‡¶∏',
                    timestamp: new Date().toISOString(),
                    user: currentUserData.name
                }]
            };

            await set(ref(database, 'parcels/' + parcelId), parcelData);
            await set(counterRef, counter);

            document.getElementById('addParcelMessage').innerHTML = `
                <div class="alert alert-success">
                    <strong>‡¶∏‡¶´‡¶≤!</strong> ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø: ${parcelId}
                </div>
            `;

            e.target.reset();
            setTimeout(() => {
                document.getElementById('addParcelMessage').innerHTML = '';
            }, 5000);
        };

        async function loadParcels() {
            const parcelsRef = ref(database, 'parcels');
            onValue(parcelsRef, (snapshot) => {
                allParcels = [];
                snapshot.forEach((child) => {
                    allParcels.push({ id: child.key, ...child.val() });
                });
                allParcels.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                displayParcels(allParcels);
            });
        }

        function displayParcels(parcels) {
            const tbody = document.getElementById('parcelTableBody');
            tbody.innerHTML = '';

            parcels.forEach(parcel => {
                const statusBadge = {
                    'pending': 'badge-pending',
                    'loaded': 'badge-loaded',
                    'unloaded': 'badge-unloaded',
                    'delivered': 'badge-delivered'
                };

                const statusText = {
                    'pending': '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç',
                    'loaded': '‡¶≤‡ßã‡¶°‡ßá‡¶°',
                    'unloaded': '‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°',
                    'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'
                };

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${parcel.parcelId}</strong></td>
                    <td>${parcel.senderName}<br><small>${parcel.senderPhone}</small></td>
                    <td>${parcel.receiverName}<br><small>${parcel.receiverPhone}</small></td>
                    <td>${parcel.destination}</td>
                    <td>${parcel.deliveryCharge} ‡ß≥</td>
                    <td><span class="badge ${statusBadge[parcel.status]}">${statusText[parcel.status]}</span></td>
                    <td>${new Date(parcel.createdAt).toLocaleDateString('bn-BD')}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-small btn-view" onclick="viewParcel('${parcel.parcelId}')">üëÅÔ∏è ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                            <button class="btn-small btn-qr" onclick="showQR('${parcel.parcelId}')">QR</button>
                            ${currentUserData.role !== 'scanner' ? `<button class="btn-small btn-delete" onclick="deleteParcel('${parcel.parcelId}')">üóëÔ∏è</button>` : ''}
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        window.searchParcels = () => {
            const query = document.getElementById('searchParcel').value.toLowerCase();
            const filtered = allParcels.filter(p => 
                p.parcelId.toLowerCase().includes(query) ||
                p.senderName.toLowerCase().includes(query) ||
                p.receiverName.toLowerCase().includes(query) ||
                p.senderPhone.includes(query) ||
                p.receiverPhone.includes(query)
            );
            displayParcels(filtered);
        };

        window.viewParcel = async (parcelId) => {
            const parcelRef = ref(database, 'parcels/' + parcelId);
            const snapshot = await get(parcelRef);
            const parcel = snapshot.val();

            const statusText = {
                'pending': '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç',
                'loaded': '‡¶≤‡ßã‡¶°‡ßá‡¶°',
                'unloaded': '‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°',
                'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'
            };

            let trackingHtml = '<div class="timeline">';
            if (parcel.tracking) {
                parcel.tracking.reverse().forEach(track => {
                    trackingHtml += `
                        <div class="timeline-item">
                            <div class="time">${new Date(track.timestamp).toLocaleString('bn-BD')}</div>
                            <div class="description">${track.status}</div>
                            <div class="location">üìç ${track.location}</div>
                            ${track.vehicleNumber ? `<div class="location">üöõ ${track.vehicleNumber}</div>` : ''}
                            <div class="location">üë§ ${track.user}</div>
                        </div>
                    `;
                });
            }
            trackingHtml += '</div>';

            document.getElementById('parcelDetails').innerHTML = `
                <h2>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ - ${parcelId}</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div>
                        <strong>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï:</strong> ${parcel.senderName}<br>
                        <strong>‡¶´‡ßã‡¶®:</strong> ${parcel.senderPhone}
                    </div>
                    <div>
                        <strong>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï:</strong> ${parcel.receiverName}<br>
                        <strong>‡¶´‡ßã‡¶®:</strong> ${parcel.receiverPhone}
                    </div>
                    <div>
                        <strong>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${parcel.destination}
                    </div>
                    <div>
                        <strong>‡¶ì‡¶ú‡¶®:</strong> ${parcel.weight || '‡¶â‡¶≤‡ßç‡¶≤‡ßá‡¶ñ ‡¶®‡ßá‡¶á'}
                    </div>
                    <div>
                        <strong>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:</strong> ${parcel.deliveryCharge} ‡ß≥
                    </div>
                    <div>
                        <strong>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü:</strong> ${parcel.paymentStatus}
                    </div>
                    <div>
                        <strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> ${statusText[parcel.status]}
                    </div>
                    <div>
                        <strong>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> ${new Date(parcel.createdAt).toLocaleString('bn-BD')}
                    </div>
                </div>
                ${parcel.description ? `<p><strong>‡¶¨‡¶ø‡¶¨‡¶∞‡¶£:</strong> ${parcel.description}</p>` : ''}
                <h3 style="margin-top: 30px;">‡¶Æ‡ßÅ‡¶≠‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
                ${trackingHtml}
            `;

            document.getElementById('parcelModal').style.display = 'block';
        };

        window.showQR = (parcelId) => {
            document.getElementById('qrTitle').textContent = '‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø: ' + parcelId;
            document.getElementById('qrcode').innerHTML = '';
            
            new QRCode(document.getElementById('qrcode'), {
                text: parcelId,
                width: 256,
                height: 256
            });

            document.getElementById('qrModal').style.display = 'block';
        };

        window.downloadQR = () => {
            const canvas = document.querySelector('#qrcode canvas');
            const url = canvas.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = url;
            a.download = 'QR_' + document.getElementById('qrTitle').textContent + '.png';
            a.click();
        };

        window.deleteParcel = async (parcelId) => {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await remove(ref(database, 'parcels/' + parcelId));
                alert('‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        };

        window.startScanner = () => {
            document.getElementById('startScanBtn').style.display = 'none';
            document.getElementById('stopScanBtn').style.display = 'inline-block';

            html5QrCode = new Html5Qrcode("qr-reader");
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: 250 },
                onScanSuccess
            );
        };

        window.stopScanner = () => {
            if (html5QrCode) {
                html5QrCode.stop();
                document.getElementById('startScanBtn').style.display = 'inline-block';
                document.getElementById('stopScanBtn').style.display = 'none';
            }
        };

        async function onScanSuccess(decodedText) {
            stopScanner();
            
            const parcelRef = ref(database, 'parcels/' + decodedText);
            const snapshot = await get(parcelRef);
            
            if (!snapshot.exists()) {
                alert('‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!');
                return;
            }

            const parcel = snapshot.val();
            const statusText = {
                'pending': '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç',
                'loaded': '‡¶≤‡ßã‡¶°‡ßá‡¶°',
                'unloaded': '‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°',
                'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'
            };

            document.getElementById('scanResult').innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶õ‡ßá!</h3>
                    <p><strong>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø:</strong> ${parcel.parcelId}</p>
                    <p><strong>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï:</strong> ${parcel.senderName} (${parcel.senderPhone})</p>
                    <p><strong>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï:</strong> ${parcel.receiverName} (${parcel.receiverPhone})</p>
                    <p><strong>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${parcel.destination}</p>
                    <p><strong>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> ${statusText[parcel.status]}</p>
                    
                    <h4 style="margin-top: 20px;">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®:</h4>
                    <div class="form-group">
                        <select id="newStatus" onchange="toggleVehicleInput()">
                            <option value="">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                            <option value="loaded">‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶§‡ßã‡¶≤‡¶æ</option>
                            <option value="unloaded">‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã</option>
                            <option value="delivered">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°</option>
                        </select>
                    </div>
                    <div class="form-group" id="vehicleInputGroup" style="display: none;">
                        <label>‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ *</label>
                        <input type="text" id="vehicleNumber" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¢‡¶æ‡¶ï‡¶æ-‡¶Æ‡ßá‡¶ü‡ßç‡¶∞‡ßã-‡¶ó-‡ßß‡ß®-‡ß©‡ß™‡ß´‡ß¨">
                    </div>
                    <div class="form-group" id="locationInputGroup" style="display: none;">
                        <label>‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® *</label>
                        <input type="text" id="currentLocation" placeholder="‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®">
                    </div>
                    <button class="btn" onclick="updateParcelStatus('${decodedText}')">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            `;
        }

        window.toggleVehicleInput = () => {
            const status = document.getElementById('newStatus').value;
            const vehicleGroup = document.getElementById('vehicleInputGroup');
            const locationGroup = document.getElementById('locationInputGroup');
            
            if (status === 'loaded') {
                vehicleGroup.style.display = 'block';
                locationGroup.style.display = 'block';
            } else if (status === 'unloaded' || status === 'delivered') {
                vehicleGroup.style.display = 'none';
                locationGroup.style.display = 'block';
            } else {
                vehicleGroup.style.display = 'none';
                locationGroup.style.display = 'none';
            }
        };

        window.updateParcelStatus = async (parcelId) => {
            const newStatus = document.getElementById('newStatus').value;
            const vehicleNumber = document.getElementById('vehicleNumber')?.value || '';
            const currentLocation = document.getElementById('currentLocation')?.value || '';

            if (!newStatus) {
                alert('‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }

            if (newStatus === 'loaded' && !vehicleNumber) {
                alert('‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
                return;
            }

            if (!currentLocation) {
                alert('‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!');
                return;
            }

            const parcelRef = ref(database, 'parcels/' + parcelId);
            const snapshot = await get(parcelRef);
            const parcel = snapshot.val();

            const statusDescriptions = {
                'loaded': '‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶§‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'unloaded': '‡¶ó‡¶æ‡¶°‡¶º‡¶ø ‡¶•‡ßá‡¶ï‡ßá ‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'
            };

            const newTracking = {
                status: statusDescriptions[newStatus],
                location: currentLocation,
                timestamp: new Date().toISOString(),
                user: currentUserData.name,
                vehicleNumber: vehicleNumber || null
            };

            const tracking = parcel.tracking || [];
            tracking.push(newTracking);

            const updates = {
                status: newStatus,
                tracking: tracking
            };

            if (newStatus === 'loaded') {
                updates.currentVehicle = vehicleNumber;
            } else if (newStatus === 'delivered') {
                updates.currentVehicle = null;
            }

            await update(parcelRef, updates);

            alert('‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            document.getElementById('scanResult').innerHTML = '';
        };

        async function loadVehicles() {
            const parcelsRef = ref(database, 'parcels');
            onValue(parcelsRef, (snapshot) => {
                const vehicles = {};
                
                snapshot.forEach((child) => {
                    const parcel = child.val();
                    if (parcel.currentVehicle) {
                        if (!vehicles[parcel.currentVehicle]) {
                            vehicles[parcel.currentVehicle] = {
                                vehicleNumber: parcel.currentVehicle,
                                parcels: [],
                                loaded: 0,
                                unloaded: 0
                            };
                        }
                        vehicles[parcel.currentVehicle].parcels.push({ id: child.key, ...parcel });
                        if (parcel.status === 'loaded') vehicles[parcel.currentVehicle].loaded++;
                        if (parcel.status === 'unloaded') vehicles[parcel.currentVehicle].unloaded++;
                    }
                });

                displayVehicles(vehicles);
            });
        }

        function displayVehicles(vehicles) {
            const grid = document.getElementById('vehicleGrid');
            grid.innerHTML = '';

            Object.values(vehicles).forEach(vehicle => {
                const destinations = [...new Set(vehicle.parcels.map(p => p.destination))];
                
                const card = document.createElement('div');
                card.className = 'vehicle-card';
                card.onclick = () => showVehicleDetails(vehicle);
                card.innerHTML = `
                    <h3>üöõ ${vehicle.vehicleNumber}</h3>
                    <p><strong>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø:</strong> ${destinations.join(', ')}</p>
                    <div class="vehicle-stats">
                        <div class="vehicle-stat">
                            <div class="label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</div>
                            <div class="value">${vehicle.parcels.length}</div>
                        </div>
                        <div class="vehicle-stat">
                            <div class="label">‡¶≤‡ßã‡¶°‡ßá‡¶°</div>
                            <div class="value">${vehicle.loaded}</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            if (Object.keys(vehicles).length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #999;">‡¶ï‡ßã‡¶®‡ßã ‡¶ó‡¶æ‡¶°‡¶º‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶®‡ßá‡¶á</p>';
            }
        }

        window.showVehicleDetails = (vehicle) => {
            let tableHtml = `
                <h2>üöõ ${vehicle.vehicleNumber}</h2>
                <h3 style="margin-top: 20px;">‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                                <th>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï</th>
                                <th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï</th>
                                <th>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
                                <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                <th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            vehicle.parcels.forEach(parcel => {
                const statusText = {
                    'loaded': '‡¶≤‡ßã‡¶°‡ßá‡¶°',
                    'unloaded': '‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°'
                };
                tableHtml += `
                    <tr>
                        <td>${parcel.parcelId}</td>
                        <td>${parcel.senderName}</td>
                        <td>${parcel.receiverName}</td>
                        <td>${parcel.destination}</td>
                        <td>${statusText[parcel.status]}</td>
                        <td>${parcel.deliveryCharge} ‡ß≥</td>
                    </tr>
                `;
            });

            tableHtml += `
                    </tbody>
                </table>
            </div>
            <h3 style="margin-top: 30px;">‡¶Æ‡ßÅ‡¶≠‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h3>
            <div class="timeline">
            `;

            vehicle.parcels.forEach(parcel => {
                if (parcel.tracking) {
                    parcel.tracking.forEach(track => {
                        if (track.vehicleNumber === vehicle.vehicleNumber) {
                            tableHtml += `
                                <div class="timeline-item">
                                    <div class="description">${parcel.parcelId} - ${track.status}</div>
                                    <div class="location">üìç ${track.location}</div>
                                    <div class="time">${new Date(track.timestamp).toLocaleString('bn-BD')}</div>
                                    <div class="location">üë§ ${track.user}</div>
                                </div>
                            `;
                        }
                    });
                }
            });

            tableHtml += `
            </div>
            <button class="btn" onclick="downloadVehiclePDF('${vehicle.vehicleNumber}')">PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            `;

            document.getElementById('vehicleDetails').innerHTML = tableHtml;
            document.getElementById('vehicleModal').style.display = 'block';
        };

        window.downloadVehiclePDF = async (vehicleNumber) => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text('Vehicle Report: ' + vehicleNumber, 14, 15);
            doc.text('Generated: ' + new Date().toLocaleString('bn-BD'), 14, 25);

            const parcelsRef = ref(database, 'parcels');
            const snapshot = await get(parcelsRef);
            const parcels = [];

            snapshot.forEach((child) => {
                const parcel = child.val();
                if (parcel.currentVehicle === vehicleNumber) {
                    parcels.push([
                        parcel.parcelId,
                        parcel.senderName,
                        parcel.receiverName,
                        parcel.destination,
                        parcel.status,
                        parcel.deliveryCharge + ' Tk'
                    ]);
                }
            });

            doc.autoTable({
                head: [['Parcel ID', 'Sender', 'Receiver', 'Destination', 'Status', 'Charge']],
                body: parcels,
                startY: 35
            });

            doc.save('Vehicle_' + vehicleNumber + '.pdf');
        };

        window.generateReport = async () => {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            if (!startDate || !endDate) {
                alert('‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!');
                return;
            }

            const parcelsRef = ref(database, 'parcels');
            const snapshot = await get(parcelsRef);
            const parcels = [];

            snapshot.forEach((child) => {
                const parcel = child.val();
                const parcelDate = new Date(parcel.createdAt).toISOString().split('T')[0];
                if (parcelDate >= startDate && parcelDate <= endDate) {
                    parcels.push(parcel);
                }
            });

            const total = parcels.length;
            const delivered = parcels.filter(p => p.status === 'delivered').length;
            const totalCharge = parcels.reduce((sum, p) => sum + parseInt(p.deliveryCharge), 0);
            const paid = parcels.filter(p => p.paymentStatus === '‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§').reduce((sum, p) => sum + parseInt(p.deliveryCharge), 0);

            let tableHtml = `
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                    <h3>‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 12px; color: #666;">‡¶Æ‡ßã‡¶ü ‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">${total}</div>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 12px; color: #666;">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°</div>
                            <div style="font-size: 24px; font-weight: 700; color: #28a745;">${delivered}</div>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 12px; color: #666;">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;">${totalCharge} ‡ß≥</div>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 12px; color: #666;">‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶ø‡¶§</div>
                            <div style="font-size: 24px; font-weight: 700; color: #28a745;">${paid} ‡ß≥</div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>‡¶™‡¶æ‡¶∞‡ßç‡¶∏‡ßá‡¶≤ ‡¶Ü‡¶á‡¶°‡¶ø</th>
                                    <th>‡¶™‡ßç‡¶∞‡ßá‡¶∞‡¶ï</th>
                                    <th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡¶ï</th>
                                    <th>‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø</th>
                                    <th>‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th>
                                    <th>‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</th>
                                    <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            parcels.forEach(parcel => {
                const statusText = {
                    'pending': '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç',
                    'loaded': '‡¶≤‡ßã‡¶°‡ßá‡¶°',
                    'unloaded': '‡¶Ü‡¶®‡¶≤‡ßã‡¶°‡ßá‡¶°',
                    'delivered': '‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶°'
                };
                tableHtml += `
                    <tr>
                        <td>${parcel.parcelId}</td>
                        <td>${parcel.senderName}</td>
                        <td>${parcel.receiverName}</td>
                        <td>${parcel.destination}</td>
                        <td>${parcel.deliveryCharge} ‡ß≥</td>
                        <td>${parcel.paymentStatus}</td>
                        <td>${statusText[parcel.status]}</td>
                    </tr>
                `;
            });

            tableHtml += `
                            </tbody>
                        </table>
                    </div>
                    <button class="btn" style="margin-top: 20px;" onclick="downloadReportPDF()">PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            `;

            document.getElementById('reportContent').innerHTML = tableHtml;
            window.reportParcels = parcels;
        };

        window.downloadReportPDF = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            doc.text('Chishtiya Transport Report', 14, 15);
            doc.text('Period: ' + startDate + ' to ' + endDate, 14, 25);

            const tableData = window.reportParcels.map(p => [
                p.parcelId,
                p.senderName,
                p.receiverName,
                p.destination,
                p.deliveryCharge + ' Tk',
                p.paymentStatus,
                p.status
            ]);

            doc.autoTable({
                head: [['ID', 'Sender', 'Receiver', 'Destination', 'Charge', 'Payment', 'Status']],
                body: tableData,
                startY: 35
            });

            doc.save('Report_' + startDate + '_to_' + endDate + '.pdf');
        };

        async function loadUsers() {
            if (currentUserData?.role !== 'admin') return;

            const usersRef = ref(database, 'users');
            onValue(usersRef, (snapshot) => {
                const tbody = document.getElementById('userTableBody');
                tbody.innerHTML = '';

                snapshot.forEach((child) => {
                    const user = child.val();
                    const roleBadge = {
                        'admin': 'badge-admin',
                        'manager': 'badge-manager',
                        'scanner': 'badge-scanner'
                    };

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td><span class="badge ${roleBadge[user.role]}">${user.role}</span></td>
                        <td>
                            ${child.key !== currentUser.uid ? 
                                `<button class="btn-small btn-delete" onclick="deleteUser('${child.key}')">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>` : 
                                '<em>‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ</em>'}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }

        window.addUser = async (e) => {
            e.preventDefault();

            const uid = document.getElementById('newUserUid').value;
            const name = document.getElementById('newUserName').value;
            const email = document.getElementById('newUserEmail').value;
            const role = document.getElementById('newUserRole').value;

            await set(ref(database, 'users/' + uid), {
                name: name,
                email: email,
                role: role
            });

            alert('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            e.target.reset();
        };

        window.deleteUser = async (uid) => {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶á ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await remove(ref(database, 'users/' + uid));
                alert('‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            }
        };

        window.closeModal = (modalId) => {
            document.getElementById(modalId).style.display = 'none';
        };

        window.onclick = (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
